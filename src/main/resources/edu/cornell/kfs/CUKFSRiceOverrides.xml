<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:p="http://www.springframework.org/schema/p"
       xmlns:util="http://www.springframework.org/schema/util"
       xmlns:cache="http://www.springframework.org/schema/cache"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
                           http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
                           http://www.springframework.org/schema/util
                           http://www.springframework.org/schema/util/spring-util-3.1.xsd
                           http://www.springframework.org/schema/cache
                           http://www.springframework.org/schema/cache/spring-cache.xsd">
    <!-- Our CUWebAuthAuthenticationService is a RemoteUserAuthenticationService subclass that can 
         also look at the HTTP headers that CUWebAuth exposes -->
         
	<bean id="kimAuthenticationService" class="edu.cornell.cynergy.service.impl.CUWebAuthAuthenticationService">
		<property name="useHttpHeaders"><value>${cynergy.cuwal.useHttpHeaders}</value></property>
	</bean>
    
  
    <!-- override encryption services  -->
 	<bean id="encryptionService" class="edu.cornell.cynergy.service.impl.AESEncryptionServiceImpl" lazy-init="true">
	  <property name="key" value="${cynergy.encryption.key}"/>
	  <property name="enabled" value="${cynergy.encryption.busEncryption}"/>
	</bean> 
	 
	<bean id="enEncryptionService" class="edu.cornell.cynergy.service.impl.AESEncryptionServiceImpl" lazy-init="true">
		<property name="key" value="${cynergy.encryption.key}"/>
		<property name="enabled" value="${cynergy.encryption.busEncryption}"/>
	</bean>
      
  <!--  UPGRADE-911
  	Understand order of operations with pulling in rice beans.  should not have to overried platformAwareDao or 
  	the rest of the DAOs for that matter.
   -->
   	
	<!-- Cynergy's "dummy" no-op anti-virus service. -->
	<bean id="dummyAntiVirusService" class="edu.cornell.cynergy.antivirus.service.DummyAntiVirusServiceImpl" />
	
	<!-- Cynergy's anti-virus service that uses ClamAV. -->
	<bean id="antiVirusService" class="edu.cornell.cynergy.clamav.ClamAVService">
		<property name="host" value="127.0.0.1" />
		<property name="port" value="3310" />
		<property name="timeout" value="60000" />
	</bean>

	<!-- Override of bean from KRADSpringBeans.xml -->
	<!-- Override of attachment service to add anti-virus scanning for attachments. -->

	<util:constant id="cynergy.kew.serviceNamespace"
			static-field="edu.cornell.cynergy.CynergyConstants.CYNERGY_KEW_NAMESPACE"/>
			
	<bean id="attachmentService" class="edu.cornell.cynergy.krad.service.impl.CynergyAttachmentServiceImpl">
		<property name="kualiConfigurationService">
			<ref bean="kualiConfigurationService" />
		</property>
		<property name="attachmentDao">
			<ref bean="attachmentDao" />
		</property>
		<property name="antiVirusService">
			<ref bean="${cynergy.antivirus.service}" />
		</property>
	</bean>
	
		<!-- Override of bean from KewLocalSpringBeans.xml -->
	<bean id="enNoteService" class="org.kuali.rice.kew.notes.service.impl.NoteServiceImpl">
		<property name="noteDAO" ref="enNoteDAO" />
		<property name="attachmentService">
			<bean class="org.kuali.rice.kew.notes.service.impl.AttachmentServiceImpl">
				<property name="attachmentDir" value="${attachment.dir.location}" />
			</bean>
		</property>
		<property name="antiVirusService">
			<ref bean="${cynergy.antivirus.service}" />
		</property>
	</bean>

	<bean id="UserOptionsServiceInner" class="org.kuali.rice.kew.useroptions.UserOptionsServiceImpl" lazy-init="true">
       <property name="userOptionsDAO">
           <ref bean="enUserOptionsDAO" />
       </property>
       <property name="reloadActionListDAO">
           <ref bean="reloadActionListDAO" />
       </property>
       <property name="lastLoginTimeDAO">
            <ref bean="lastLoginTimeDAO" />
        </property>
    </bean>
   
   <!-- CYNERGY-2210: Added the "reloadActionListDAO" bean needed for the "RELOAD_ACTION_LIST" fix. -->
   <!--  UPGRADE-911
    <bean id="reloadActionListDAO" class="org.kuali.rice.kew.useroptions.dao.impl.ReloadActionListDaoJdbcImpl">
        <constructor-arg>
            <ref bean="kewNonTransactionalDataSource"/>
        </constructor-arg>
    </bean>
    -->
        
     <bean id="jdbcLastLoginTimeDAO" class="edu.cornell.cynergy.kew.dao.jdbc.impl.LastLoginTimeDaoJdbcImpl">
		<constructor-arg>
			<ref bean="kewNonTransactionalDataSource" />
		</constructor-arg>
	</bean>
	
    <bean id="cynergyRESTLastLoginTimeService" class="edu.cornell.cynergy.kew.rest.service.impl.RESTLastLoginTimeServiceImpl">
		<property name="useHttpHeaders" value="true" />
		<property name="lastLoginTimeDAO" ref="jdbcLastLoginTimeDAO" />
	</bean>
	
	<bean class="org.kuali.rice.ksb.api.bus.support.ServiceBusExporter">
		<property name="serviceBus" ref="rice.ksb.serviceBus" />
		<property name="serviceDefinition">
			<bean class="org.kuali.rice.ksb.api.bus.support.RestServiceDefinition">
				<property name="serviceNameSpaceURI" ref="cynergy.kew.serviceNamespace" />
				<property name="localServiceName" value="restLastLoginTimeService" />
				<property name="service" ref="cynergyRESTLastLoginTimeService" />
				<property name="resourceClass" value="edu.cornell.cynergy.kew.rest.service.RESTLastLoginTimeService" />
			</bean>
		</property>
	</bean>
   
   <bean id="abstractDataSourceBase" abstract="true"> 
        <property name="driverClassName" value="${rice.datasource.driver.name}"/> 
        <property name="validationQuery" value="${rice.datasource.validating.query}"/> 
        <property name="url" value="${rice.datasource.url}"/> 
        <property name="username" value="${rice.datasource.username}" /> 
        <property name="password" value="${rice.datasource.password}" /> 
	</bean> 


    
    <bean id="financialSystemDocumentService" class="edu.cornell.kfs.sys.document.service.impl.CUFinancialSystemDocumentServiceImpl">
		<property name="documentService" ref="documentService" />
		<property name="documentAdHocService" ref="documentAdHocService" />
		<property name="parameterService" ref="parameterService" />
		<property name="financialSystemDocumentDao" ref="financialSystemDocumentDao" />
		
	</bean>
	
	<bean id="kewNonTransactionalDataSource" class="org.kuali.rice.core.framework.persistence.jdbc.datasource.PrimaryDataSourceFactoryBean" lazy-init="true">
		<property name="nullAllowed" value="true"/>
		<property name="nonTransactionalDataSource" value="true"/>
		<property name="preferredDataSourceParams">
			<list>
				<value>kew.nonTransactional.datasource</value>
			</list>
		</property>
		<property name="preferredDataSourceJndiParams">
			<list>
				<value>kew.nonTransactional.datasource.jndi.location</value>
			</list>
		</property>
		<property name="serverDataSource" value="false"/>
	</bean>
</beans>